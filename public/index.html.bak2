<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel KDS - Enterprise</title>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/style.css">

    <!-- Auth Check (Security) -->
    <script>
        const token = localStorage.getItem('kds_token');
        if (!token) {
            window.location.href = 'login.html';
        }

        // Optional: Add Logout Button Logic Later
    </script>
</head>

<body>

    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="logo-area">
                <div class="icon-hotel">ğŸ¨</div>
                <h1>OTEL KDS</h1>
                <p>Enterprise Edition</p>
            </div>

            <nav class="menu">
                <a href="#" class="menu-item active" data-target="dashboard">
                    ğŸ“Š Genel BakÄ±ÅŸ
                </a>
                <a href="#" class="menu-item" data-target="simulation">
                    ğŸ§  SimÃ¼lasyon & Planlama
                </a>
                <a href="#" class="menu-item" data-target="raw-data">
                    ğŸ“‚ GeÃ§miÅŸ Veriler
                </a>
            </nav>

            <!-- Saved Scenarios Section -->
            <div id="saved-scenarios-container" style="margin-top: 5px; padding: 0 20px;">
                <h4
                    style="color: #64748b; font-size: 11px; text-transform: uppercase; margin-bottom: 8px; margin-top: 15px;">
                    Kaydedilenler
                </h4>
                <ul id="saved-scenarios-list" style="list-style: none; padding: 0;">
                    <li style="color: #94a3b8; font-size: 13px;">YÃ¼kleniyor...</li>
                </ul>
            </div>

            <div class="user-profile" id="btn-logout" style="cursor: pointer;" title="Ã‡Ä±kÄ±ÅŸ Yap">
                <div class="avatar">YG</div>
                <div class="info">
                    <strong>YÃ¶netici GiriÅŸi</strong>
                    <span>Admin (Ã‡Ä±kÄ±ÅŸ)</span>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">

            <!-- HEADER -->
            <header class="top-header">
                <h2 id="page-title">Genel BakÄ±ÅŸ</h2>
                <div class="date-display">
                    ğŸ—“ï¸ <span id="current-date">AralÄ±k 2025</span>
                </div>
            </header>

            <!-- PAGE 1: DASHBOARD -->
            <section id="dashboard" class="page-section active">

                <!-- 1. Global Chart: Ridgeline Overview (At Top) -->
                <div id="dynamic-charts-container" class="charts-grid"
                    style="display: flex; flex-direction: column; gap: 30px; margin-bottom: 50px;">
                    <!-- Charts will be injected here by JS -->
                </div>

                <!-- 2. Detail Analysis Section (Wrapper) -->
                <div class="detail-analysis-wrapper" style="border-top: 1px solid #e2e8f0; padding-top: 40px;">

                    <!-- Header & Selector -->
                    <div class="controls-section"
                        style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="section-title" style="margin: 0;">YÄ±llÄ±k Genel BakÄ±ÅŸ & Analiz (USD)</h2>
                        <select id="detail-year-select" class="form-select"
                            style="width: 150px; font-weight: bold; padding: 10px;">
                            <!-- Options populated by JS -->
                        </select>
                    </div>

                    <!-- KPI Cards (The "Veriler") - MOVED HERE -->
                    <!-- "GrafiÄŸin hemen Ã¼stÃ¼nde" + "BoÅŸluk bÄ±rak" -->
                    <div class="kpi-grid" style="margin-bottom: 40px;">
                        <div class="kpi-card">
                            <h3>Toplam YÄ±llÄ±k Gelir (Ort.)</h3>
                            <p class="value" id="kpi-income">â‚º0</p>
                        </div>
                        <div class="kpi-card">
                            <h3>Ortalama Doluluk (Genel)</h3>
                            <p class="value" id="kpi-occupancy">%0</p>
                        </div>
                        <div class="kpi-card">
                            <h3>Toplam MÃ¼ÅŸteri (YÄ±llÄ±k Ort.)</h3>
                            <p class="value" id="kpi-customers">0</p>
                        </div>
                        <div class="kpi-card">
                            <h3>Ortalama Oda FiyatÄ±</h3>
                            <p class="value" id="kpi-price">â‚º0</p>
                        </div>
                    </div>

                    <!-- Detail Charts (Pie & Bar) -->
                    <div class="charts-grid">
                        <!-- Left: Income vs Expense Balance (Pie) -->
                        <div class="chart-card">
                            <h3>Gelir vs Gider Dengesi</h3>
                            <div class="chart-container">
                                <canvas id="chart-detail-pie"></canvas>
                            </div>
                        </div>

                        <!-- Right: Monthly Performance (Bar) -->
                        <div class="chart-card wide">
                            <h3>AylÄ±k Performans Trendi</h3>
                            <div class="chart-container">
                                <canvas id="chart-detail-bar"></canvas>
                            </div>
                        </div>
                    </div>

                </div>

            </section>

            <!-- PAGE 2: SIMULATION -->
            <section id="simulation" class="page-section">
                <div class="simulation-layout">
                    <!-- INPUT PANEL -->
                    <div class="input-panel">
                        <div class="scenario-tabs">
                            <button class="tab-btn active" onclick="switchScenario('A')">Senaryo A (KÃ¶tÃ¼)</button>
                            <button class="tab-btn" onclick="switchScenario('B')">Senaryo B (Normal)</button>
                            <button class="tab-btn" onclick="switchScenario('C')">Senaryo C (Ä°yi)</button>
                        </div>

                        <h3>âš™ï¸ Parametreler</h3>

                        <div class="form-group">
                            <label>Referans YÄ±l</label>
                            <select id="sim-ref-year" disabled>
                                <option value="2024" selected>2024 GerÃ§ekleÅŸen</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <button class="btn-primary"
                                style="width: 100%; margin-bottom: 24px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #6366f1, #4f46e5); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);"
                                onclick="openWizard()">
                                <span style="font-size: 20px; margin-right: 8px;">ğŸ§™â€â™‚ï¸</span>
                                <strong>AkÄ±llÄ± Fiyat SihirbazÄ±</strong>
                            </button>
                            <label>Enflasyon Tahmini (%)</label>
                            <input type="range" id="sim-inflation" min="0" max="100" value="40">
                            <span class="range-val" id="val-inflation">40%</span>
                            <small>Mutfak, Sabit, DiÄŸer Giderleri etkiler.</small>
                        </div>

                        <div class="form-group">
                            <label>Personel Zam OranÄ± (%)</label>
                            <input type="range" id="sim-raise" min="0" max="100" value="50">
                            <span class="range-val" id="val-raise">50%</span>
                            <small>Sadece Personel Giderini etkiler.</small>
                        </div>

                        <div class="form-group">
                            <label>Hedef Doluluk (%)</label>

                            <!-- AI Forecast Controls -->
                            <div
                                style="display: flex; gap: 10px; margin-bottom: 8px; align-items: center; background: #f8fafc; padding: 8px; border-radius: 6px; border: 1px solid #e2e8f0;">
                                <select id="forecast-season"
                                    style="padding: 4px; border-radius: 4px; border: 1px solid #cbd5e1; font-size: 12px; flex: 1;">
                                    <option value="low">â„ï¸ KÄ±ÅŸ (DÃ¼ÅŸÃ¼k Sezon)</option>
                                    <option value="mid">ğŸ‚ Bahar (GeÃ§iÅŸ)</option>
                                    <option value="high" selected>â˜€ï¸ Yaz (YÃ¼ksek Sezon)</option>
                                    <option value="yearly">ğŸ“… YÄ±llÄ±k (Genel)</option>
                                </select>
                                <button id="btn-predict"
                                    style="flex: 1; padding: 4px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; display: flex; align-items: center; justify-content: center; gap: 4px;">
                                    âš¡ AI Tahmini
                                </button>
                            </div>

                            <input type="range" id="sim-occupancy" min="10" max="100" value="70">
                            <span class="range-val" id="val-occupancy">70%</span>
                        </div>

                        <div class="form-group">
                            <label>Hedef Kar MarjÄ± (%)</label>
                            <input type="range" id="sim-margin" min="0" max="100" value="25">
                            <span class="range-val" id="val-margin">25%</span>
                        </div>
                        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e0e0e0;">

                        <button onclick="saveCurrentScenario()" style="
                            width: 100%; 
                            padding: 12px; 
                            background: #10b981; 
                            color: white; 
                            border: none; 
                            border-radius: 8px; 
                            font-weight: bold; 
                            cursor: pointer; 
                            font-size: 14px;
                            display: flex; 
                            align-items: center; 
                            justify-content: center;
                            gap: 8px;">
                            ğŸ’¾ Bu Senaryoyu Kaydet
                        </button>
                    </div>

                    <!-- OUTPUT PANEL -->
                    <div class="output-panel">

                        <!-- AI BOX -->
                        <div class="ai-summary-card">
                            <div class="ai-avatar">ğŸ¤–</div>
                            <div class="ai-content">
                                <h3>KDS ASÄ°STANI</h3>
                                <p id="ai-text">Analiz bekleniyor...</p>
                            </div>
                        </div>
                        <div class="suggestion-card">
                            <h3>Ã–NERÄ°LEN ODA FÄ°YATI (2025)</h3>
                            <div class="price-display" id="sim-suggested-price">â‚º0</div>
                            <div class="sub-info">
                                Tahmini Maliyet: <span id="sim-unit-cost">â‚º0</span>
                            </div>
                        </div>

                        <div class="chart-card">
                            <h3>Tahmini Gider DaÄŸÄ±lÄ±mÄ±</h3>
                            <div class="chart-container small">
                                <canvas id="chart-sim-breakdown"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <h3>AylÄ±k Kar Tahmini</h3>
                            <div class="chart-container small">
                                <canvas id="chart-sim-profit"></canvas>
                            </div>
                        </div>

                        <!-- NEW: Monthly Expense Breakdown Chart -->
                        <div class="chart-card">
                            <h3>AylÄ±k Tahmini Gider (Sabit vs DeÄŸiÅŸken)</h3>
                            <div class="chart-container small">
                                <canvas id="chart-sim-expense-trend"></canvas>
                            </div>
                        </div>

                        <!-- SENSITIVITY ANALYSIS (NEW) -->
                        <div class="chart-card" id="sensitivity-card">
                            <h3>DuyarlÄ±lÄ±k Analizi (Neye Dikkat Etmeli?)</h3>
                            <div class="chart-container small">
                                <canvas id="chart-sensitivity"></canvas>
                            </div>
                            <small
                                style="display:block; margin-top:10px; color:#666; font-size:11px; text-align:center;">
                                * DeÄŸiÅŸkenler %10 kÃ¶tÃ¼leÅŸirse kÃ¢r ne kadar dÃ¼ÅŸer?
                            </small>
                        </div>
                    </div>
                </div>
            </section>

            <section id="raw-data" class="page-section">
                <h3>ğŸ“‚ GeÃ§miÅŸ Veriler & Finansal Analiz</h3>
                <p>Bu bÃ¶lÃ¼mde geÃ§miÅŸ yÄ±llara ait finansal performans ve doluluk verilerini inceleyebilirsiniz.</p>

                <!-- NEW: Historical Analysis Charts -->
                <div class="filters" style="margin-top: 20px;">
                    <label>Analiz YÄ±lÄ±:</label>
                    <select id="history-year-select">
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                    </select>
                </div>

                <div class="charts-grid" style="margin-top: 20px; margin-bottom: 40px;">
                    <div class="chart-card">
                        <h3>Doluluk Trendi: GerÃ§ekleÅŸen vs Hedef</h3>
                        <div class="chart-container">
                            <canvas id="chart-history-occupancy"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Finansal Trend: Gelir vs Gider</h3>
                        <div class="chart-container">
                            <canvas id="chart-history-finance"></canvas>
                        </div>
                    </div>
                </div>


            </section>

        </main>
    </div>

    <!-- Application Logic -->
    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>
    <!-- WIZARD MODAL -->
    <div id="wizard-modal" class="modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); z-index: 9999; justify-content: center; align-items: center;">
        <div class="modal-card"
            style="background: white; padding: 32px; border-radius: 16px; width: 500px; max-width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <h2 style="font-size: 24px; font-weight: 700; color: #1e293b; margin-bottom: 8px;">ğŸ§™â€â™‚ï¸ AkÄ±llÄ± Fiyat
                Hedefleyicisi</h2>
            <p style="color: #64748b; margin-bottom: 24px;">YÄ±l sonu hedefinizi belirleyin, gerekli fiyat politikasÄ±nÄ±
                biz hesaplayalÄ±m.</p>

            <!-- Step 1: Target Type -->
            <div id="wizard-step-1">
                <label style="display: block; font-weight: 600; color: #334155; margin-bottom: 8px;">ğŸ¯ Hedefin
                    Nedir?</label>
                <select id="wizard-target-type" class="form-control" style="width: 100%; margin-bottom: 16px;">
                    <option value="profit">Net KÃ¢r Hedefi Belirlemek Ä°stiyorum ($)</option>
                    <option value="growth">GeÃ§en Seneye GÃ¶re BÃ¼yÃ¼me Ä°stiyorum (%)</option>
                </select>

                <label style="display: block; font-weight: 600; color: #334155; margin-bottom: 8px;">Miktar /
                    Oran:</label>
                <input type="number" id="wizard-target-value" class="form-control" placeholder="Ã–rn: 500000 veya 20"
                    style="width: 100%;">

                <div style="margin-top: 24px; text-align: right;">
                    <button class="btn-primary" onclick="wizardNextStep()">Devam Et â¡ï¸</button>
                    <button
                        style="border: none; background: transparent; color: #64748b; margin-right: 12px; cursor: pointer;"
                        onclick="closeWizard()">Ä°ptal</button>
                </div>
            </div>

            <!-- Step 2: Occupancy Prediction -->
            <div id="wizard-step-2" style="display: none;">
                <label style="display: block; font-weight: 600; color: #334155; margin-bottom: 8px;">ğŸ¨ Beklenen Doluluk
                    OranÄ±</label>
                <p style="font-size: 13px; color: #64748b; margin-bottom: 12px;">Bu hedefi tutturmak iÃ§in otelin yÃ¼zde
                    kaÃ§ dolu olacaÄŸÄ±nÄ± Ã¶ngÃ¶rÃ¼yorsunuz?</p>
                <input type="range" id="wizard-occupancy" min="10" max="100" value="70"
                    style="width: 100%; margin-bottom: 8px;"
                    oninput="document.getElementById('wizard-occ-val').innerText = this.value + '%'">
                <div style="text-align: center; font-weight: bold; color: #4f46e5; margin-bottom: 24px;"
                    id="wizard-occ-val">70%</div>

                <div style="margin-top: 24px; text-align: right;">
                    <button class="btn-primary" onclick="wizardCalculate()">ğŸš€ Hesapla</button>
                    <button
                        style="border: none; background: transparent; color: #64748b; margin-right: 12px; cursor: pointer;"
                        onclick="wizardStep(1)">â¬…ï¸ Geri</button>
                </div>
            </div>

            <!-- Step 3: Result -->
            <div id="wizard-result" style="display: none; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ’</div>
                <h3 style="color: #1e293b; margin-bottom: 8px;">Ã–nerilen Ortalama Oda FiyatÄ±</h3>
                <div id="wizard-final-price"
                    style="font-size: 36px; font-weight: 800; color: #10b981; margin-bottom: 16px;">$0</div>

                <div id="wizard-analysis"
                    style="background: #f1f5f9; padding: 16px; border-radius: 8px; text-align: left; font-size: 14px; color: #334155; margin-bottom: 24px;">
                    Analiz yÃ¼kleniyor...
                </div>

                <button class="btn-primary" onclick="applyWizardPrice()">Bunu Uygula âœ…</button>
                <button
                    style="margin-top: 12px; border: none; background: transparent; color: #64748b; cursor: pointer; display: block; width: 100%;"
                    onclick="closeWizard()">Kapat</button>
            </div>

        </div>
    </div>

    <script src="js/simulation.js"></script>
</body>

</html>